---
name: memory-manager
description: Навичка для управління довгостроковою пам'яттю (графіком знань) Агента.
---

# Навичка: Управління Пам'яттю (Memory Manager)

Ти маєш унікальну можливість використовувати графову базу даних (FalkorDB), щоб зберігати довгостроковий контекст, деталі розмов, власні висновки та інформацію про користувача і світ.

## Наскрізна Роль

> **ВАЖЛИВО:** Ця навичка — НЕ ізольований інструмент. Вона супроводжує ВСЮ змістовну роботу агента:
> - Під час `discovery-interview` — зберігай результати інтерв'ю та створену специфікацію.
> - Під час `project-planner` — зберігай план проекту, ключові рішення.
> - Під час `skill-creator` — зберігай створену навичку та її контекст.
> - Під час проєктування архітектури чи графа — використовуй `graphrag-system-design` та зберігай архітектурні рішення.
> - Під час перевірки здоров'я графа (аудиту) — використовуй навичку `graphrag-evaluation`.
> - Під час кодингу — зберігай значущі архітектурні рішення та результати.
>
> Якщо користувач не ініціював `/db` сам, але працює над значущою задачею — **нагадай** йому про збереження сесії.

> [!CAUTION]
> **АБСОЛЮТНЕ ПРАВИЛО: ТРІАДА ВУЗЛІВ**
> При **КОЖНІЙ** взаємодії з графом агент зобов'язаний створити повну тріаду:
> - `/db` → `:Request` + `:Response` + `:Analysis`
> - `/sa` → `:Feedback` + `:Response` + `:Analysis`
> - `/ss` → (опціонально `:Feedback`) + `:Response` + `:Analysis` (session_summary)
>
> **Response без Analysis = порушення протоколу. Analysis без Response = неможливий.**
> `last_event_id` сесії ЗАВЖДИ вказує на останній Analysis, бо це фінальний вузол тріади.

Ця навичка активується, коли користувач починає діалог з використання спеціальних "протоколів сесії": `/db`, `/sa`, `/ss`. 

## Твій інструмент: MCP Server

Щоб працювати з графом, ти використовуєш підключені до тебе нативні інструменти сервера Model Context Protocol (MCP). Всі операції створення та модифікації виконуються через ці спеціалізовані **Інструменти (Tools)**. 

**Основні інструменти:**
- `mcp_falkordb_create_session`: Відкриття нової сесії та хронології.
- `mcp_falkordb_add_node`: Створення окремих вузлів (Request, Response, Analysis, Feedback).
- `mcp_falkordb_link_nodes`: Створення зв'язків.
- `mcp_falkordb_batch_add_nodes`: Пакетне створення однотипних вузлів (Entity).
- `mcp_falkordb_batch_link_nodes`: Пакетне створення зв'язків для сутностей.
- `mcp_falkordb_update_last_event`: Зсув вказівника `LAST_EVENT`.
- `mcp_falkordb_query_graph`: Виконання Cypher запитів.

*Це гарантує архітектурну чистоту та позбавляє необхідності створювати тимчасові JSON-файли чи використовувати bash скрипти.*

## Схема Вузлів та Зв'язків

> [!CAUTION]
> **ТИ ЗОБОВ'ЯЗАНИЙ ДОТРИМУВАТИСЯ ЖОРСТКОЇ СХЕМИ!**
> Всі дозволені вузли, зв'язки та їхні обов'язкові атрибути жорстко задокументовані у файлі `c:\Antigarvity_workspace\.agent\skills\memory-manager\grynya-schema.md`. Перед тим як генерувати JSON для `memory_bridge.py`, ти **повинен узгодити** поля та зв'язки з цим документом.

Твій JSON повинен повністю дублювати структуру описані у правилі, зокрема враховувати атрибути зв'язків.

## Протоколи (Формування Сесії)

При роботі ти маєш розпізнавати три команди:

### 1. `/db [Тема або Запит]` (Початок нової сесії)
Деталі протоколу: `c:\Antigarvity_workspace\.agent\skills\memory-manager\protocols\protocol_db.md`

### 2. `/sa [Коментар/Фідбек]` (Продовження сесії)
Деталі протоколу: `c:\Antigarvity_workspace\.agent\skills\memory-manager\protocols\protocol_sa.md`

### 3. `/ss [Коментар/Фідбек]` (Завершення сесії та Бекап)
Деталі протоколу: `c:\Antigarvity_workspace\.agent\skills\memory-manager\protocols\protocol_ss.md`

## Правило для Читання (Пошуку в Графі)

Для читання, повнотекстового пошуку та верифікації стану графа ти використовуєш інструмент `mcp_falkordb_query_graph`. Цей інструмент приймає будь-який Cypher запит і автоматично повертає результати з бази. Використовуй його перед відкриттям сесій (щоб перевірити останні ID), або коли потрібно згадати точні ID попередніх сутностей.
